<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SecureHealth Scheduling</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Shared navbar styles -->
  <link href="/assets/css/navbar.css" rel="stylesheet">
  <!-- Role-aware navbar script -->
  <script src="/assets/js/navbar.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <style>
    :root {
      --primary-color: #2c5aa0;
      --secondary-color: #1e3a5f;
      --accent-color: #4a90e2;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --light-bg: #f8f9fa;
      --dark-text: #2c3e50;
    }
    
    body { 
      background-color: #f8f9fa; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding-top: 80px;
    }
    
    .navbar-custom {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    }
    
    .btn-custom {
      padding: 12px 30px;
      border-radius: 25px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }
    
    .btn-primary-custom {
      background: var(--accent-color);
      border: 2px solid var(--accent-color);
      color: white;
    }
    
    .btn-primary-custom:hover {
      background: transparent;
      color: var(--accent-color);
      transform: translateY(-2px);
    }
    
    .badge-pill { border-radius: 10rem; }
    .navbar-nav .nav-link.active { text-decoration: underline; }
    
    .role-badge {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .role-doctor { background-color: #dc3545; color: white; }
    .role-nurse { background-color: #0d6efd; color: white; }
    .role-receptionist { background-color: #6c757d; color: white; }
    .role-admin { background-color: #6f42c1; color: white; }
    .role-user { background-color: #6c757d; color: white; }
  </style>
</head>
<body>
  <!-- Role-aware navbar will be inserted here -->
  <div id="navbar-container"></div>

  <main class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h3 mb-1">Reception Appointment Scheduling</h1>
        <p class="text-muted mb-0">Book doctor appointments for patients. Only reception staff can access this tool.</p>
      </div>
      <span class="badge bg-primary text-uppercase">Receptionist Only</span>
    </div>

    <div class="row">
      <div class="col-lg-5 mb-4">
        <div class="card shadow-sm">
          <div class="card-header bg-white">
            <h2 class="h5 mb-0">Create Appointment</h2>
          </div>
          <div class="card-body">
            <div id="appointmentAlert" class="alert d-none" role="alert"></div>
            <form id="appointmentForm" novalidate>
              <div class="mb-3">
                <label for="patientSelect" class="form-label fw-semibold">Patient</label>
                <select id="patientSelect" class="form-select" required>
                  <option value="" disabled selected>Select a patient</option>
                </select>
                <small class="form-text text-muted">Showing the most recent patient records.</small>
              </div>
              <div class="mb-3">
                <label for="scheduledAt" class="form-label fw-semibold">Date &amp; Time</label>
                <input type="datetime-local" id="scheduledAt" class="form-control" required>
                <small class="form-text text-muted">Times are saved using the clinic timezone.</small>
              </div>
              <div class="mb-3">
                <label for="appointmentNotes" class="form-label fw-semibold">Notes (optional)</label>
                <textarea id="appointmentNotes" class="form-control" rows="3" placeholder="Add any helpful context"></textarea>
              </div>
              <button type="submit" class="btn btn-primary w-100">Schedule Appointment</button>
            </form>
          </div>
        </div>
      </div>
      <div class="col-lg-7 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h2 class="h5 mb-0">Upcoming Appointments</h2>
            <button class="btn btn-sm btn-outline-secondary" id="refreshAppointments">
              <i class="fas fa-sync-alt me-1"></i> Refresh
            </button>
          </div>
          <div class="card-body">
            <div id="appointmentsEmpty" class="text-center text-muted py-4 d-none">
              <i class="far fa-calendar-plus fa-2x mb-3"></i>
              <p class="mb-0">No appointments scheduled yet. Create one using the form.</p>
            </div>
            <div class="table-responsive">
              <table class="table table-striped mb-0" id="appointmentsTable">
                <thead class="table-light">
                  <tr>
                    <th>Patient</th>
                    <th>Scheduled For</th>
                    <th>Notes</th>
                    <th>Created By</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for navbar to initialize, then check authentication
      setTimeout(() => {
        checkAuthentication();
      }, 100);
      
      function checkAuthentication() {
        // Get user from navbar
        const user = window.secureHealthNavbar.getCurrentUser();
        
        if (!user) {
          window.location.href = '/login.html';
          return;
        }

        // Check if user is receptionist
        const isReceptionist = window.secureHealthNavbar.hasRole('receptionist');
        const isAdmin = window.secureHealthNavbar.hasRole('admin');
        
        // Allow both receptionists and admins to access scheduling
        if (!isReceptionist && !isAdmin) {
          window.location.href = '/login.html';
          return;
        }

        console.log('Scheduling access granted for:', user.username || user.email);
      }
    });
  </script>
  <script>
    window.appointmentConfig = {
      patients: []
    };
  </script>
  <script src="/assets/js/appointments.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
